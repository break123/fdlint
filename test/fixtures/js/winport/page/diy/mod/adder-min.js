(function(d,c){var e=c.Util,a=c.diy.ModListDialog;var b={init:function(){this.regions=d("#winport-content div.region");this.boxes=d("div.mod-box",this.regions);this.initBoxRegionAdder();this.initBoxFlyAdder();this.handleAdderEvent();this.handleNearestBoxHover()},initBoxRegionAdder:function(){var g=this,f=d("div.box-adder",this.regions);f.hover(function(){d(this).addClass("box-adder-hover")},function(){d(this).removeClass("box-adder-hover")})},initBoxFlyAdder:function(){var f=this;this.boxes.live("mouseenter",function(){var g=d(this);e.schedule("nearest-box-hover",function(){f.doBoxHover(g)},10)});this.boxes.live("movestart",d.proxy(this,"hideFlyAdder"))},doBoxHover:function(g){if(this.lastHoverBox&&this.lastHoverBox[0]===g[0]){return}var f=g.data("box-config");this.hideFlyAdder();if(f&&f.movable){g.addClass("mod-box-movable");this.lastHoverBox=g}},hideFlyAdder:function(){this.lastHoverBox&&this.lastHoverBox.removeClass("mod-box-movable");this.lastHoverBox=null},handleAdderEvent:function(){var f=this,g=d("#content");d("div.box-adder",g).live("click",function(i){i.preventDefault();var h=d(this).closest("div.region");new a(h)});d("a.box-fly-adder",g).live("click",function(j){j.preventDefault();var k=d(this),i=k.closest("div.region"),h=k.closest("div.mod-box").index();new a(i,h)})},handleNearestBoxHover:function(){var g=this,h=d("#doc")[0],f=d("body")[0],i=d("div.content-wrap:first")[0];d(document).mousemove(function(l){var k=l.target,j=null;if(k===i||k===h||k===f){j=function(){var m=g.getNearestBox(l.pageX,l.pageY);m&&g.doBoxHover(m)};e.schedule("nearest-box-hover",j,10)}})},getNearestBox:function(g,k){var f=null,j=Number.MAX_VALUE,i=Number.MAX_VALUE,h=null;h=d("div.mod-box",this.regions).filter(function(){var l=d(this).data("box-config");return l&&l.movable});h.each(function(){var l=d(this),p=l.offset(),o=p.left+l.width()/2,m=p.top,q=Math.round(Math.abs(o-g)),n=Math.round(Math.abs(m-k));if(q<j||Math.abs(q-j)<10&&n<i){j=q;i=n;f=l}});return f}};c.PageContext.register("~BoxAdder",b)})(jQuery,Platform.winport);