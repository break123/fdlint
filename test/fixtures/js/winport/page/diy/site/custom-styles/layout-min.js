(function(e,d){var f=d.Util,c=d.diy.Msg,b=d.diy.Diy,a=d.diy.site.CustomStyles.Parts;a.Layout={init:function(){this.panel=e("li.custom-styles-layout",this.div);this.ul=e("div.setting-node-content>ul",this.panel);this.lis=e("li",this.ul);this.lastLi=e("li.selected",this.ul);this.layout=e("div.layout.p32-s5m0,div.layout.p32-m0s5","#winport-content");this.layoutData=this.layout.closest("div.layout-box").data("box-config")||{};this.docCfg=e("#doc").data("doc-config");this.contentCfg=e("#content").data("content-config");this.handleEvents()},handleEvents:function(){var g=this;this.lis.click(function(j){j.preventDefault();if(g.running){return}var h=e(this),i=h.data("layout");if(h.hasClass("selected")){return}g.changeLayout(h,i);g.updateLayout(h,i)})},changeLayout:function(g,j){var h=e("li.selected",this.ul),i=h.data("layout").classname;this.lis.removeClass("selected");g.addClass("selected");this.layout.addClass(j.classname).removeClass(i)},updateLayout:function(g,k){var h=this,j=null,i=this.config.customizeLayoutUrl;j=function(){if(g[0]===h.lastLi[0]){return}h.running=true;b.authAjax(i,{type:"POST",data:h.wrapUpdateData(k.cid),dataType:"json",success:function(l){h.updateSuccess(l,g,k)},error:function(){h.restoreLayout(g,k)},complete:function(){h.running=false}})};f.schedule("style-layout",j)},wrapUpdateData:function(g){return{layoutCid:g,_csrf_token:this.docCfg._csrf_token,version:this.contentCfg.version,pageSid:this.contentCfg.sid}},updateSuccess:function(h,g,i){++(this.contentCfg.version);if(h.success){this.lastLi=g;this.layoutData.cid=i.cid;e(window).trigger("diychanged",{type:"custom-style-layout"});c.info("布局版式设置成功")}else{if(h.data==="VERSION_EXPIRED"){window.location.reload()}else{this.restoreLayout(g,i);c.error("布局版式设置失败")}}},restoreLayout:function(g,i){var h=this.lastLi.data("layout").classname;this.lis.removeClass("selected");this.lastLi.addClass("selected");this.layout.addClass(h).removeClass(i.classname)}}})(jQuery,Platform.winport);