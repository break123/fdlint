(function(c,b){var d=b.Util;var a=function(f,g){if(!c.isArray(f)){f=[f];if(!c.isPlainObject(g)){f.push(g);g=arguments[2]}}if(!c.isArray(f[0])){f=[f]}g=g||{};var e=h("When",g.when),i=h("How",g.how);c.each(f,function(){var l=this,j=l[0],k=l[1];e(j,function(){var m=typeof k==="function"?k.apply(this,arguments):k;m!==false&&i(m,this,g,arguments)},g)});function h(k,j){j=j||"default";return typeof j==="string"?c.proxy(a[k],j):c.proxy(j,g)}};a.When={"default":function(e,k,f){var i=f.once,h=f.delegate,g=function(){var l=c(this);if(i&&l.data("tracelog-once")){return}k.apply(this,arguments);i&&l.data("tracelog-once",true)};if(h){h=h===true?"body":h;c(h).delegate(e,f.event||this._getDelegateEvent(e),g)}else{var j=c(e);if(j.length>5){c.log("TraceLog warn: more than 5 element matches with selector: "+e)}j.bind(f.event||this._getDefaultEvent(j),g)}},_getDefaultEvent:function(e){if(e.is("a,button")){return"mousedown"}if(e.is("select")){return"change"}return e.is("input")&&e.attr("type")==="text"?"blur":"mousedown"},_getDelegateEvent:function(f){if(typeof f!=="string"){c.error("argument error, should be an string.")}var e=(/\b([\w-]+)(?:\.[\w-]+)*(?:\[[^\]]+\])*$/.exec(f)||{})[1];return e==="input"?"click":e==="select"?"change":"mousedown"},inputtext:function(e,j,f){var g=f.delegate,h=function(){var k=c(this);k.data("tracelog-last",k.val())},i=function(){var k=c(this);if(k.data("tracelog-last")!==k.val()){j.apply(this,arguments)}};g=g===true?"body":g;if(g){c(g).delegate(e,"focusin",h);c(g).delegate(e,"focusout",i)}else{e=c(e);e.bind("focus",h);e.bind("blur",i)}},exposure:function(e,j,g){var f=this,i=c(e),h=function(){if(i.data("tracelog-exposure")){return}if(f._isVisible(i)){j.call(i);i.data("tracelog-exposure",true)}};c(window).bind("scroll resize",h);h()},_isVisible:function(h){var f=c(window),g=h.offset().top,e=f.scrollTop();return h.is(":visible")&&e<g&&g<e+f.height()}};a.How={"default":function(g,i,f){var h=typeof f.param==="function"?f.param(i):f.param;if(f.url){var e=new Image();e.src=d.formatUrl(f.url,h||{})}else{if(g){aliclick(null,"?tracelog="+g)}}}};b.widget.TraceLog=a;c.add("wp-tracelog")})(jQuery,Platform.winport);