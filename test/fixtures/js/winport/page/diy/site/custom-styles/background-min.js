(function(f,d){var h=d.Util,g=d.UI,c=d.diy.Msg,b=d.diy.Component,e=d.diy.ImageUpload,a=d.diy.site.CustomStyles.Parts;a.Background={init:function(){this.panel=f("li.custom-styles-background",this.div);this.subject="contentBackground";this.styleConfig=this.getStyleConfig(this.subject,true);this.styleJson=this.styleConfig.styleJson;this.initMode();this.initModeCustom()},initMode:function(){var i=f('dl.mode-tabs input[name="background-mode"]',this.panel);this.initModeTabs(i);this.initModeStyle(i)},initModeTabs:function(k){var j=f("ul.mod-bodies>li",this.panel),i=this.styleConfig.isEnable?0:1;k.click(function(){var l=k.index(this);j.removeClass("selected");j.eq(l).addClass("selected")});k.eq(i).click()},initModeStyle:function(j){var i=this;j.click(function(){var k=j.index(this),l=k===0?"transparent":false;i.styleConfig.isEnable=k===0;i.CssParser.setStyle(i.styleJson,"#winport-content","background",l);i.updateStyleConfig(i.subject)})},initModeCustom:function(){this.customDiv=f("li.mode-custom",this.panel);this.initBkColor();this.initBkImage();this.initBkRepeat();this.initBkPosition()},initBkColor:function(){var j=this,k=f("dl.bk-color a.widget-color-picker",this.customDiv),i=f("input.value",k),l=this.getStyle("background-color","#FFFFFF");i.val(l.value);g.colorPicker(k);k.bind("select",function(o,n){var m=n.color;j.updateStyle("background-color",m)})},initBkImage:function(){var k=this,i=f("dl.bk-image",this.customDiv),m=f("div.preview",i),j=f("input.path",m),l=this.getStyle("background-image","none"),n=this.CssParser.getBkImgUrl(l.value);config=this.getUploadConfig();config.onUpload=function(o){g.resizeImage(f("img",m),80);k.updateStyle("background-image","url("+o+")");k.showImagePropsPanel(true)};config.onRemove=function(){k.updateStyle("background-image","none");k.showImagePropsPanel(false)};n&&j.val(n);this.showImagePropsPanel(n);new e(i,config);g.resizeImage(f("img",m),80)},getUploadConfig:function(k){var i=this,j=b.getDocConfig();return{_csrf_token:j._csrf_token,imageUploadUrl:this.config.imageUploadUrl,uid:j.uid,noScale:true}},showImagePropsPanel:function(i){var j=f("dl.bk-repeat,dl.bk-position",this.customDiv);j.css("display",i?"block":"none")},initBkRepeat:function(){var j=this,i=f("dl.bk-repeat select",this.customDiv),k=this.getStyle("background-repeat","repeat");i.val(k.value);i.change(function(){j.updateStyle("background-repeat",f(this).val())})},initBkPosition:function(){var j=this,i=f("dl.bk-position input",this.customDiv),k=this.getStyle("background-position","left top"),l=k.value;i.filter(function(){return f(this).data("value")===l}).addClass("checked");i.click(function(){var m=f(this);i.removeClass("checked");m.addClass("checked");j.updateStyle("background-position",m.data("value"))})},getStyle:function(k,i){var j=this.CssParser.getStyle(this.styleJson,".content-wrap",k);if(!j&&i){j=this.CssParser.setStyle(this.styleJson,".content-wrap",k,i)}return j},updateStyle:function(k,j,i){this.CssParser.setStyle(this.styleJson,".content-wrap",k,j);this.updateStyleConfig(this.subject)}}})(jQuery,Platform.winport);