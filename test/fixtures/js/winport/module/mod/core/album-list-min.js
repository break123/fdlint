(function(i,C){var n=C.UI,k=C.Util,d=i.util.ua.ie67,h=C.widget.Paging,w,e,f,B,l,x,m,E,o=null,q=null,p=null,v,u=[];function t(){this.init.apply(this,arguments)}t.prototype={init:function(I,H,G){this.context=I;this.config=H;this.inMainRegion=i(I).closest("div.region").hasClass("main-wrap");var F=this,J=i("div.m-content",I);n.showLoading(J);u.push({context:I,config:H,callback:function(K){if(K.result==="success"){if(K.dataList[H.albumName].length===0){z(J);return}F.renderAlbumList(K);if(!F.inMainRegion){y(I)}if(d){var L=i(I).closest("div.mod-box");i("div.box-shim",L).height(L.height()-8)}if(H.needPaging){i("ul.album-list-main",I).addClass("album-page-1");F.pagingAlbumList(K,H.pageSize,I)}}else{g(J)}},error:function(){g(J)}});G&&D()},renderAlbumList:function(G){var I=i("div.m-content",this.context),H={},F=this.config.end;H.albumList=G.dataList[this.config.albumName];if(F){H.albumCount=(H.albumList.length<F)?H.albumList.length:F}else{H.albumCount=H.albumList.length}H.inMainRegion=this.inMainRegion;H.className=this.inMainRegion?"album-list-main":"album-list-sub";I.html(c(H))},pagingAlbumList:function(H,F,I){var G=this,J=i("div.m-content",I);modPaging=new h(J,{css:{className:"wp-album-paging"},pageClick:function(K){r(K,G.context,G.config,G.inMainRegion)},pageSubmit:function(K){r(K,G.context,G.config,G.inMainRegion)}});modPaging.init(1,F,H.total)}};function y(F){var G=i("div.cover img",F);n.resizeImage(G,64)}function r(K,H,G,J){var F=i("ul.album-page-"+K,H);if(F.length>0){i("ul.album-list-main",H).not(F).hide();F.fadeIn("slow");return}var L=s(G.pageSize,K),I=i("div.m-content",H);i.ajax(E,{type:"GET",dataType:"script",data:L,success:function(){var M=window[L.jsResponseDataName];if(!M){g(I);return}if(M.result==="success"){var Q=M.dataList[G.albumName];if(Q.length===0){z(I);return}var O=i("ul.album-list-main",H),P={albumList:Q,albumCount:Q.length,inMainRegion:J,className:J?"album-list-main":"album-list-sub"};var N=i(c(P));N.addClass("album-page-"+K).hide();if(i("ul.album-list-main",H).length>=5){i("ul.album-list-main:first",H).remove()}i("ul.album-list-main",H).hide();i("ul.album-list-main:last",H).after(N);N.fadeIn("slow")}else{g(I)}},error:function(){g(I)}});return false}function s(F,G){return{memberId:m,jsResponseDataName:"albumList"+new Date().getTime(),hasAlbums:true,start:(G-1)*F+1,end:G*F}}function c(F){return FE.util.sweet('<ul class="<%= className %>">				<% for (var i=0; i< albumCount; i++) { %>					<% var album = this.initAlbumData(albumList[i]);%>					<li>						<div class="cover">						<% var albumTitle = this.escape(album.title); %>							<a target="_blank" href="<%= album.link %>" title="<%= albumTitle %>"><img alt="<%= albumTitle %>" src="<%= album.cover %>"></a>							<div class="cover-label"></div>						</div>						<div class="title">							<a target="_blank" title="<%= albumTitle %>" href="<%= album.link %>"><%= $util.escape(album.subTitle) %></a>						</div>						<div class="count">							<%= album.count %>’≈Õº∆¨						</div>					</li>				<% } %>			</ul>').applyData(F,{initAlbumData:F.inMainRegion?b:A,escape:k.escape})}function b(F){F.cover=(F.lock===1)?l:(F.coverId!==null)?F.coverSumm.replace(".summ.jpg",".search.jpg"):(F.count===0)?w:f;F.coverWidth=F.coverHeight=150;F.link=q.replace("(ALBUM_ID_PLACEHOLDER)",F.id);F.subTitle=F.title;return F}function A(F){F.cover=(F.lock===1)?x:(F.coverId!==null)?F.coverSumm:(F.count===0)?e:B;F.coverWidth=F.coverHeight=64;F.link=q.replace("(ALBUM_ID_PLACEHOLDER)",F.id);var G=F.title;F.subTitle=(k.lenB(G)>42)?(k.cut(G,40)+".."):G;return F}C.ModContext.bind("nodeallready",D);function D(){if(u.length<=0){return}j(u[0].config);var F=a();i.ajax(E,{type:"GET",dataType:"script",timeout:20000,data:F,success:function(){var G=window[F.jsResponseDataName];if(!G){i.each(u,function(H,I){I.error()});return}i.each(u,function(H,I){I.callback(G)});u=[]},error:function(){i.each(u,function(G,H){H.error()})}})}function j(F){var G=i("#doc").data("doc-config");q=F.albumLink;E=F.recommendAlbumListUrl;p=G.imageServer;m=G.uid;w=w?w:p+"/images/app/platform/winport/mod/albums/no-photo-150.gif";e=e?e:p+"/images/app/platform/winport/mod/albums/no-photo-64.gif";f=f?f:p+"/images/app/platform/winport/mod/albums/no-cover-150.gif";B=B?B:p+"/images/app/platform/winport/mod/albums/no-cover-64.gif";l=l?l:p+"/images/app/platform/winport/mod/albums/lock-150.gif";x=x?x:p+"/images/app/platform/winport/mod/albums/lock-64.gif"}function a(){var F=0,G={memberId:m,jsResponseDataName:"albumList"+new Date().getTime()};i.each(u,function(I,J){var H=J.config;if(H.hasRecAlbums){G.hasRecAlbums=true;G.recommendAlbumIds=H.recommendAlbumIds}if(H.hasAlbums){G.hasAlbums=true;G.start=1;if(H.end>F){F=G.end=H.end}}});return G}function z(F){F.html('<p class="empty-album">‘›Œﬁœ‡≤·</p>')}function g(F){F.html('<p class="album-error">Õ¯¬Á∑±√¶£¨«ÎÀ¢–¬∫Û÷ÿ ‘</p>')}C.ModContext.register("wp-albums",t);C.ModContext.register("wp-recommend-albums",t);C.ModContext.register("wp-albums-column",t)})(jQuery,Platform.winport);