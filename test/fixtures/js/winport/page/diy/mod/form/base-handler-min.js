(function(f,d){var h=d.Util,b=d.widget.FormUtil,c=d.diy.Msg,e=d.diy.ModBox,a=d.diy.Diy;var g={init:function(k,i,j){this.form=k;this.config=i;this.box=j},validate:function(){return true},submit:function(j){var i=this,j=this.form;if(this.isSubmitting){return}this.dialog.showLoading("正在保存..");this.isSubmitting=true;this.__$saveBox(function(k){i.dialog.showLoading(false);i.isSubmitting=false;var l=i._afterSubmit(k);if(l===undefined){l=k.success}l&&f(window).trigger("diychanged",{type:"save-box"})})},__$saveBox:function(o){var i=this,k=f("#doc").data("doc-config"),m=f("#content").data("content-config"),n=this.box.data("box-config"),j=m.saveParamUrl,l={_csrf_token:k._csrf_token,pageSid:m.sid,cid:n.cid,sid:n.sid};l=f.extend(l,this._getFormData()||{});a.authAjax(h.formatUrl(j,"_input_charset=UTF-8"),{type:"POST",data:l,dataType:"json",success:o,error:function(){c.error("设置板块失败，请刷新后重试")}})},_getFormData:function(){var i=this.form;return i?b.getFormData(i):null},_afterSubmit:function(i){return i.success},_refreshBox:function(){e.reload(this.box)}};d.diy.form.BaseHandler=g})(jQuery,Platform.winport);