(function(f,z){var A=z.diy,r=f.util.ua.ie6,s=f.util.ua.ie,a=f.util.ua.ie67,j=z.UI,k=z.diy.ModBox,c=A.BoxUtil,y=A.BoxBar,p=A.Msg,b=A.RequestHandler,i=z.diy.BoxOperateChecker,m,e,t=/.*\s(main-wrap|grid-sub|extra)\s.*/i,w={canNotIn:"抱歉，该区域不支持移入板块",notSingle:"抱歉，该区域已有相同板块，不能再次移入"},o;var d={init:function(){l();v()}};function l(){f("div.mod-box").each(function(F,E){var G=f(E);if(!G.data("box-config").movable){G.addClass("ui-portlets-disable")}})}function v(){var E=f("#winport-content"),F={items:" div.mod-box:not(.ui-portlets-disable)",columns:"div.region",placeholder:"box-dd-placeholder",helper:q,cursorAt:{top:14},revert:250,revertOuter:true,start:D,dropOnEmpty:B,over:g,stop:n};E.portlets(F)}function q(G,F){var E=f('<div class="box-dd-helper">			<div class="mod">				<div class="m-body"></div>			</div>			<div class="dd-helper-shim"></div>		</div>');f("div.m-body",E).append(f("div.m-header",F).clone());return E}function C(E,F){return f('<div class="box-dd-placeholder"></div>')}function D(G,H){var F=H.currentItem,E=H.helper,I=H.placeholder;x(F,I);f("#winport-content").data("sorting",true);F.trigger("ddstart");f.each(H.columns,function(J,K){var M=f(K.dom);if(M[0]===H.originalColumn[0]){return}if(!h(H.currentItem,M)){M.addClass("ui-portlets-unreceivable");o="notSingle";return}var L=t.exec(" "+M[0].className+" "),N;if(L&&L[1]){N=L[1]}else{f.log("box-dd : cannot match regionName : "+M);return}if(!i.ddCheck(F,N)){M.addClass("ui-portlets-unreceivable");o="canNotIn";return}})}function x(F,J){var I=parseFloat(J.css("border-top-width")),E=parseFloat(J.css("border-bottom-width")),K=I+E,G=parseFloat(J.css("margin-bottom")),H=F.height();phHeight=a?H-K-G:H-K-G;J.height(phHeight)}function B(E,F){f("div.box-adder",F.currentColumn).before(F.placeholder);return false}function h(F,G){var H=F.data("box-config"),E=true;if(H.singletonInRegion){f("div.mod-box:not(.ui-portlets-placeholder)",G).each(function(J,I){var I=f(I);if(I.data("box-config")["cid"]===H.cid){E=false;return false}})}return E}function g(E,F){if(F.currentColumn.hasClass("ui-portlets-unreceivable")){p.warn(w[o])}}function n(F,G){var E=G.currentItem,H=E.data("box-config"),I=false;u(E);f("#winport-content").removeData("sorting");A.RequestHandler.savePageLayout();if(H.needReload&&G.currentColumn[0]!==G.originalColumn[0]){j.showLoading(f("div.m-content",E));E.trigger("ddstop");I=true;k.reload(E)}!I&&E.trigger("ddstop");f("div.region",this).removeClass("ui-portlets-unreceivable")}function u(G){var H=G.parents("div.region");G.data("region",c.getComponentArea(H));var F=H.parents("div.layout");G.data("layout",c.getComponentArea(F));var E=F.parents("div.segment");G.data("segment",E[0].id)}z.diy.BoxDDHandler=d;z.PageContext.register("~BoxDDHandler",d)})(jQuery,Platform.winport);