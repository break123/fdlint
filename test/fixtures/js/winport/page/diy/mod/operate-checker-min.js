(function(n,j){var h=j.diy.BoxUtil,l=/move|up|down|left|right/i;var g={check:function(u,s,t){var r;if(s==="edit"){r=k(u)}else{if(s==="del"||s==="delConfirm"){r=q(u)}else{if(s.match(l)){r=f(u,s,t)}}}if(!r.pass){r.resultCode="warn"}return r},ddCheck:function(r,s){if(!r.data("box-config")["movable"]){return false}return p(r,s)}};function k(s){var r={};r.pass=s.data("box-config")["editable"];return r}function q(s){var r={};r.pass=s.data("box-config")["deletable"];return r}function f(t,x,z){var A={},w=false,s=x,r=t.data("box-config");z=z||false;A.pass=false;A.message="抱歉，该区域不支持移入板块";if(r&&!r.movable){return A}if(s==="move"){w=true}else{if(s==="up"){w=o(t)}else{if(s==="down"){w=m(t)}else{if(s==="left"||s==="right"){var u=h.getDstRegion(t,s),v=u.name,y=u.obj;if(typeof v!=="undefined"){if(!v||!p(t,v)){return A}if(!z&&i(t,y)){A.message="抱歉，该区域已有相同板块，不能再次移入";return A}w=true}}}}}A.pass=w;return A}function o(r){var s=h.prevBox(r);return s.length>0&&s.data("box-config")["movable"]}function m(s){var r=h.nextBox(s);return r.length>0&&r.data("box-config")["movable"]}function p(u,r){var t=h.getComponentArea(u.closest("div.layout")),s=h.getComponentArea(u.closest("div.segment")),v=u.data("location-rule")||c(u);return a(v.canIn,s,t,r)&&!e(v.canNotIn,s,t,r)}function c(s){var r=s.data("box-config"),v=r.canNotIn,t=r.canIn,u={canIn:b(t),canNotIn:b(v)};s.data("location-rule",u);return u}function b(x){var u,w=[],r;if(typeof x==="undefined"||x===""){return w}u=x.split(",");for(var t=0;t<u.length;t++){x=u[t].split(".");r={};for(var s=0;s<x.length;s++){var v=s===0?"segment":(s===1?"layout":"region");r[v]=x[s]}w.push(r)}return w}function a(u,s,r,t){if(u===[]){return false}return d(u,s,r,t)}function e(u,s,r,t){if(u===[]){return true}return d(u,s,r,t)}function d(x,v,u,w){var y=false,r=false,t=false,s=false;n.each(x,function(z,A){y=(A.segment==="*"||A.segment===v);r=(A.layout==="*"||A.layout===u);t=(A.region==="*"||A.region===w);if(y&&r&&t){s=true;return false}});return s}function i(u,t){var s=u.data("box-config"),x=s.cid,r=s.singletonInRegion,w=0,v=false;n("div.mod-box",t).each(function(z,y){if(x===n(y).data("box-config")["cid"]&&r){v=true;return false}});return v}j.diy.BoxOperateChecker=g})(jQuery,Platform.winport);