(function(b,a){var c=a.Util;var d=new a.Class({init:function(e){this.config=e||{}},loadCategories:function(f,e){if(this.config.useMock){return f(this._getMockCats())}this._load(this.config.loadCategoriesUrl,null,"_filterCats",f,e)},_filterCats:function(e){return e},loadOffers:function(f,g,e){if(this.config.useMock){return g(this._getMockOffers({ids:f}))}var f=f.join(",");this._load(this.config.loadOffersUrl,{ids:f},"_filterLoadOffers",g,e)},searchOffers:function(h,i,f){if(this.config.useMock){return i(this._getMockOffers(h))}var e=h.category||{},g={isSysCat:e.type!=="userDefine",pageNum:h.pageIndex,privateFilter:this.config.privateFilter||"none"};e.id&&(g.categoryId=e.id);h.keywords&&(g.keywords=h.keywords);g=b.paramSpecial(g);this._load(this.config.searchOffersUrl,g,"_filterSearchOffers",i,f)},_filterSearchOffers:function(f){var e=this._filterOffers(f.offers);return{offers:e,pageCount:f.totalPage,pageIndex:f.currentPage}},_filterLoadOffers:function(f){var e=this._filterOffers(f);return{offers:e,pageCount:1,pageIndex:1}},_filterOffers:function(e){return b.map(e||[],function(f){return b.extendIf({price:f.priceStr,image:f.summImg,detailUrl:f.offerDetailUrl,date:f.gmtExpire},f)})},_load:function(g,i,h,j,f){var e=this,h=b.proxy(this,h);if(!g){b.error("url is not specified")}b.ajax(g,{dataType:"jsonp",cache:false,data:i||{},success:function(k){k.success?j(h(k.data)):f?f():false},error:f})},_getMockCats:function(){return[{id:1,name:"1234567890"},{id:2,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品3",children:[{id:456,name:"下一级１"},{id:567,name:"最佳啊啊一二三四五六七"}]},{id:123,name:"神品4"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品6"},{id:123,name:"神品7"},{id:123,name:"1234567890"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品3",children:[{id:456,name:"下一级１"},{id:567,name:"最佳啊啊一二三四五六七"}]},{id:123,name:"神品4"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品6"},{id:123,name:"神品7"},{id:123,name:"1234567890"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品3",children:[{id:456,name:"下一级１"},{id:567,name:"最佳啊啊一二三四五六七"}]},{id:123,name:"神品4"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品6"},{id:123,name:"神品7"},{id:123,name:"1234567890"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品3",children:[{id:456,name:"下一级１"},{id:567,name:"最佳啊啊一二三四五六七"}]},{id:123,name:"神品4"},{id:123,name:"一二三四五六七八九十一二三四"},{id:123,name:"神品6"},{id:123,name:"神品7"}]},_getMockOffers:function(k){var j=k.ids,e=k.pageIndex,f=k.pageSize;if(!j){j=[];for(var h=0;h<f;h++){j.push(e*5+h)}}var g=b.map(j,function(i){return{id:i,title:"神品"+i+'号一二<script> &&">script><&*&^"";\'三四五六七八九十十二三四五六七八九十十一',price:Math.random()>0.8?parseInt(Math.random()*100000)+"元":"",image:"http://fd.aliued.cn/i/50x50.png",detailUrl:"http://detail.china.alibaba.com/buyer/offerdetail/926553205.html",date:"2011.12.13"}});return{offers:g,pageSize:5,pageIndex:e,pageCount:100}}});a.unit.VasOfferChooserDataProvider=d;b.add("wp-vas-offer-chooser-data-provider")})(jQuery,Platform.winport);