(function(j,g){var b=g.diy,i=g.Util,h=i.isIE6,f=g.UI,d=b.BoxUtil,a=b.RequestHandler,c=b.BoxOperateChecker,m=g.diy.BaseOperateHandler;var q=j.extend({},m,{operation:"move",direction:"",_prepare:function(){this._setDst();this.__placeHolder=this.__initPlaceHolder()},_setDst:j.noop,__initPlaceHolder:function(){var r=j('<div class="box-move-placeholder"></div>');if(h){r.css("padding-bottom",0).css("margin-bottom",0)}return r},_beforeUI:function(r){r.trigger("movestart");m.bgiframe("open")},_afterUI:function(r){r.trigger("movestop");m.bgiframe("close")},_save:function(){a.savePageLayout(this.src,this.operation)}});q.base=q;var k=j.extend({},q,{_check:function(){return c.check(this.src,"up")&&c.check(this.dst,"down")},_handleUI:function(u){var r=this,x=this.src,y=this.dst,t=j("div.m-content,div.m-footer",x),w=j("div.m-content,div.m-footer",y),s=this.operation,v=this.base;if(y.length<1){return}r._beforeUI(r._src);r._src.css("z-index",198);x.add(y).wrapAll(this.__placeHolder);t.css("opacity",0.2);w.css("opacity",0.2);x.animate({top:"-"+(y.height())},500,function(){j(this).css("top",0);t.css("opacity","")});y.animate({top:"+"+(x.height())},500,function(){j(this).css("top","");w.css("opacity","");r._src.css("z-index","");x.insertBefore(y);x.unwrap();r._afterUI(r._src);u()})}});var p=j.extend({},k,{operation:"up",_setDst:function(){this._src=this.src;this.dst=d.prevBox(this.src)}});var e=j.extend({},k,{operation:"down",_setDst:function(){var r=(this._src=this.src);this.src=d.nextBox(r);this.dst=r}});var l=j.extend(q,{_setDst:function(){var t=this.src,s=this.operation,r=d.getDstRegion(t,s);this.dst=j("div.box-adder",r.obj)},_handleUI:function(w){var z=this,r=this.src,t=j("div.m-content,div.m-footer",r),x=this.dst,v=r.offset(),u=x.offset(),s=this.base;if(x.length>0){var y=this.__placeHolder;y.height(r.height());y.css("overflow","visible");r.wrap(y);z._beforeUI(r);r.css("overflow","hidden").css("z-index",198);t.css("opacity",0.2);x.fadeOut();r.animate({top:+(u.top-v.top),left:+(u.left-v.left),width:x.width()},500,function(){r.unwrap();r.insertBefore(x);z._afterUI(r);r.css("top","").css("left","");t.css("opacity","");x.fadeIn();var A=r.offset(),E=j(document),B=E.scrollTop(),D=(A.top<B),C=(A.top+r.height()>j(window).height()+B);if(D||C){j(document).scrollTop(r.offset().top-43)}if(r.data("box-config").needReload){f.showLoading(j("div.m-content",r));a.reloadBox(r)}r.css("width","").css("overflow","").css("z-index","");w()});r.closest("div.box-move-placeholder").animate({height:0},{duration:500,step:function(){j(this).css("overflow","visible")}})}}});var o=j.extend({},l,{operation:"left"});var n=j.extend({},l,{operation:"right"});b.BoxOperateHandler.up=p;b.BoxOperateHandler.down=e;b.BoxOperateHandler.right=n;b.BoxOperateHandler.left=o})(jQuery,Platform.winport);