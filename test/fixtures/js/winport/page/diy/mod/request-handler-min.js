(function(e,y){var b=y.ModContext,g=y.Util,w=y.widget.FormUtil,l=y.diy.ModBox,z=y.diy,v=z.Diy,g=y.Util,q=z.Component,p=z.Msg,a,B,s,k,t,x,n,u,i,o={"main-wrap":"MAIN","grid-sub":"SIDE","grid-extra":"EXTRA"},m=null,f=false,C=null,A=2000,h=true,r=null,d=500;var c={init:function(){a=e("#doc").data("doc-config");B=a._csrf_token;s=e("#content");k=s.data("content-config");t=k.sid;x=k.cid;n=k.editFormUrl;u=k.getBoxUrl;i=k.saveLayoutUrl;m=q.getPageLayout()},getBox:function(D){l.reload(D)},updateBox:function(D){this.getBox(D)},reloadBox:function(D){this.getBox(D)},getEditFormUrl:function(D){return n+"-"+t+"-"+D.data("box-config").sid+".htm?__envMode__=EDIT"},delBox:function(E,G){if(C){clearTimeout(C)}var D=q.getPageLayout(),F={};F[E]=G;v.authAjax(i,{type:"POST",data:{_csrf_token:B,version:k.version,pageSid:k.sid,pageContent:D,delList:"[{"+E+':"'+G+'"}]'},dataType:"json",success:function(H){if(H.success){e(window).trigger("diychanged",{type:"del-box"});++k.version;if(f){p.info("ÒÆ¶¯°å¿é³É¹¦")}p.info("É¾³ý°å¿é³É¹¦");f=false}else{if(H.data&&H.data==="VERSION_EXPIRED"){window.location.reload();return}p.error("É¾³ý°å¿éÊ§°Ü£¬ÇëË¢ÐÂºóÖØÊÔ")}}})},savePageLayout:function(){j()}};function j(){if(C){f=true;clearTimeout(C)}C=setTimeout(function(){h=false;var D=q.getPageLayout();if(D!==m){m=D;v.authAjax(i,{type:"POST",data:{_csrf_token:B,version:k.version,pageSid:k.sid,pageContent:D,delList:"[]"},dataType:"json",success:function(E){if(E.success){e(window).trigger("diychanged",{type:"move-box"});++k.version;p.info("ÒÆ¶¯°å¿é³É¹¦")}else{if(E.data&&E.data==="VERSION_EXPIRED"){window.location.reload();return}p.error("ÒÆ¶¯°å¿éÊ§°Ü£¬ÇëË¢ÐÂºóÖØÊÔ")}h=true}})}},A)}z.RequestHandler=c;y.PageContext.register("~RequestHandler",c)})(jQuery,Platform.winport);