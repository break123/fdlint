(function(h,f){var g=f.diy.Msg,l=f.Util,e=f.UI,c=f.widget.Tabs,b=f.widget.FormUtil,n=f.diy.Diy,a=f.diy.ImageUpload,i=f.diy.ModBox,k=f.diy.form.BaseHandler;var j=h.extendIf({init:function(){k.init.apply(this,arguments);this.mod=h("div.default-sub-mod",this.box).eq(0);this.lastData=this._getData();this.docCfg=h("#doc").data("doc-config");this.name="CompanyNameHandler";l.initParts(this)},getFormConfig:function(o){return{width:"800px",height:"212px",centerFooter:true}},_afterSubmit:function(o){if(o.success){this.dialog.close();g.info("…Ë÷√’–≈∆≥…π¶")}else{g.error("…Ë÷√’–≈∆ ß∞‹")}},cancel:function(){var o=this.lastData;h("input.path",this.part).val(o.bgImgPath);this.updateMod(o)},_getData:function(){var p=b.getFormData(this.form),o=h("input.topbanner-custom",this.form);p.isUseCustomTopBanner=o.prop("checked");return p},_getFormData:function(){var o=this._getData();return this._wrapSubmitData(o)},_wrapSubmitData:function(p){var o=/^http:\/\/[^\/]+\//;p.bgImgPath=p.bgImgPath.replace(o,"");p.logoImgPath=p.logoImgPath.replace(o,"");return p},updateMod:function(t){t=t||this._getData();h.log(t);var q=this.mod,u=h("div.logo a",q),s=h("img",u),r=h("a.chinaname",q),p=h("a.enname",q),o=t.isUseCustomTopBanner&&t.bgImgPath?"url("+t.bgImgPath+")":"";this.mod.triggerHandler("updatemod",t);q.css({"background-image":o,"background-repeat":o?"repeat":""});if(!s.length){s=h("<img />").appendTo(u)}if(t.logoImgPath){s.attr("src",t.logoImgPath).show();e.resizeImage(s,80)}else{s.hide()}r.toggleClass("hidden",!t.isShowCompanyNameCn);r.css({color:t.companyNameCnFontColor,"font-family":t.companyNameCnFontFamily,"font-size":t.companyNameCnFontSize,"font-weight":t.isCompanyNameCnFontBold?"bold":"normal","font-style":t.isCompanyNameCnFontItalic?"italic":"normal"});p.toggleClass("hidden",!t.isShowCompanyNameEn);p.css({color:t.companyNameEnFontColor,"font-family":t.companyNameEnFontFamily,"font-size":t.companyNameEnFontSize,"font-weight":t.isCompanyNameEnFontBold?"bold":"normal","font-style":t.isCompanyNameEnFontItalic?"italic":"normal"})},wrapUploadConfig:function(o){return h.extend(o,{_csrf_token:this.docCfg._csrf_token,imageUploadUrl:this.config.imageUploadUrl,uid:this.docCfg.uid})}},k);var d=(j.Parts={});d.TopbarPart={init:function(){this.part=h("div.topbanner-part",this.form);this.initTabs();this.initImageUpload();this.handleUpdateMod()},initTabs:function(){var p=this,q=h("ul.topbanner-tabs :radio",this.part),o=h("ul.topbanner-bodies li",this.part);q.click(function(){var r=q.index(this);o.removeClass("selected").eq(r).addClass("selected");p.updateMod()});q.filter(":checked").click()},initImageUpload:function(){var o=this,p=h("div.preview",this.part);config=this.wrapUploadConfig({onUpload:function(){e.resizeImage(h("img",p),{width:360,height:68});o.updateMod();o.dialog.node.trigger("topbanner-upload")}});new a(this.part,config);e.resizeImage(h("img",p),{width:360,height:68})},refreshBannerHeight:function(r){var q=this,o=h("input.banner-height",this.part),s=h("input.path",this.part).val(),p=null;if(!r){this.mod.css("height","");o.val("");return}if(!s){return}p=new Image();p.onload=function(){p.onload=null;var t=q.calcBannerHeight(this.height);q.mod.css("height",t);o.val(t)};p.src=s},calcBannerHeight:function(o){var q=90,p=200;return o<q?"":o>p?p+"px":o+"px"},handleUpdateMod:function(){var o=this;this.mod.unbind("updatemod.refreshbanner");this.mod.bind("updatemod.refreshbanner",function(q,p){o.refreshBannerHeight(p.isUseCustomTopBanner)})}};d.NamePart={init:function(){this.part=h("div.company-name-part",this.form);this.initNamePart();this.initImageUpload()},initImageUpload:function(){var p=this,o=h("div.logo-part",this.part),q=h("div.preview",o);config=this.wrapUploadConfig({onUpload:function(){var r=h("img",o);e.resizeImage(h("img",q),80);p.updateMod();p.dialog.node.trigger("logo-upload")},onRemove:function(){p.updateMod();p.dialog.node.trigger("logo-remove")}});new a(o,config);e.resizeImage(h("img",q),80)},initNamePart:function(){var o=h("div.name-part",this.part);this.initColorPicker(o);this.initNamePartSetting(o);this.initNamePartUpdate(o)},initColorPicker:function(q){var o=this,p=h("a.widget-color-picker",q);e.colorPicker(p);p.bind("select",function(){o.updateMod()})},initNamePartSetting:function(r){var o=this,p=h("input.show-zh,input.show-en",r),q=h("a.setting",r);p.click(function(){var s=h(this).closest("dt").find("a.setting");s[this.checked?"show":"hide"]();s.triggerHandler("click",true)});p.triggerHandler("click");q.click(function(u,t){var s=h(this).closest("dl").find("dd");t=t||s.css("display")!=="none";s[t?"hide":"show"]();return false})},initNamePartUpdate:function(q){var o=this,p=function(){o.updateMod()};h("select",q).change(p);h(":checkbox",q).click(p)}};var m={init:function(q,o,p){this.box=p;this.bodies=h("div.app-edit-body",this.dialog.node);this.parts=h("div.mod>div",p);this.loadLetFormHandler(h.proxy(this,"_init"))},getFormConfig:function(o){return j.getFormConfig(o)},loadLetFormHandler:function(p){if(f.diy.form.LetFormHandler){p();return}var o="http://style.china.alibaba.com/js/itbu/app/let-form-handler.js";h.ajax(o,{dataType:"script",cache:false,success:p})},_init:function(){this.initLetFormHandlerProxy();this.initTabs();this.initBodies()},initLetFormHandlerProxy:function(){this.LetFormHandlerProxy=h.extendIf({_getFormData:function(){var o=j._getFormData();h.extend(o,f.diy.form.LetFormHandler._getFormData());return o}},f.diy.form.LetFormHandler)},initTabs:function(){var o=this,p=h("ul.app-edit-tabs li",this.dialog.node);p.click(function(){o.selectedIndex=h(this).index()});this.selectedIndex=p.filter("li.selected").index()},initBodies:function(){var o=this;this.bodies.each(function(r,p){var s=o.getHandler(r),t=h("form",p),q=t.data("formConfig");s.dialog=o.dialog;s.init(t,q,o.box)})},getHandler:function(o){return o===0?j:this.LetFormHandlerProxy},validate:function(){return this._delegate("validate",arguments)},submit:function(){return this._delegate("submit",arguments)},cancel:function(){this._delegate("cancel",arguments);i.reload(this.box)},_delegate:function(p,o){var q=this.getHandler(this.selectedIndex);return q[p].apply(q,o)}};f.diy.form.CompanyNameHandler=m})(jQuery,Platform.winport);