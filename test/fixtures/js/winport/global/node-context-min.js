(function(c,b){var a=function(e,d){this._defaultOptions=c.extend({entryName:"init",configField:"nodeConfig",lazy:false,once:true,root:null},d);this.name=e;this.length=0;this._nodes={};this._guid=0;this._handleDomReady()};c.extend(a.prototype,{register:function(g,f,e){if(typeof g!=="string"){e=f;f=g;g="~"+this.name.toLowerCase()+this._guid++}if(this._nodes[g]){c.log("warn: "+this.name+" "+g+" already exist, ignore it.");return}e=c.extend({},this._defaultOptions,e);e.context=c.isFunction(f);if(e.context){f={init:this._wrapProtoInit(g,f)}}else{f.init=this._wrapStaticInit(g,f)}var d=this,h={name:g,config:f,options:e};this._nodes[g]=h;this.length++;c.log(this.name+" "+g+" registered.");if(this._isDomReady&&!e.lazy){this.init(g)}return this},_handleDomReady:function(){var d=this;c(function(){d.init();d._isDomReady=true})},isNodeAllReady:function(){return this._isDomReady},init:function(e){var d=this;if(typeof e==="string"){var f=this._nodes[e];if(!f){c.error(this.name+" "+e+" is not exists.")}return this._initNode(f)}if(e){c(e).each(function(){var g=d._resolveNode(this);if(!g){c.log(d.name+" can not resolve node");c.log(this);return}d._initElement(this,g)})}else{c.each(this._nodes,function(){var g=this;if(!g.options.lazy){d._initNode(g)}});this.trigger("nodeallready");c.log(d.name+" nodeallready")}},refresh:function(d,e){this._refreshData=e===undefined?true:e;this.init(d);this._refreshData=null},_wrapProtoInit:function(e,g){var d=this,f=function(){};f.prototype=g.prototype;return function(k,j,i){k=c(k);var h=d._getElementInstance(k,e);if(!h){h=new f();d._setElementInstance(k,e,h)}return d._beforeInit(k,j,i,h)&&g.apply(h,arguments)}},_wrapStaticInit:function(f,e){var d=this,g=e.init;return function(j,i,h){return d._beforeInit(j,i,h,e)&&g.apply(e,arguments)}},_beforeInit:function(e,g,f,d){data={element:e,config:g,refreshData:f,context:d};return this.triggerHandler("beforeinit",data)!==false},_getElementInstance:function(g,f){var e=this._getElementCache(g,"nodeContextInstance"),d=this.name+"."+f;return e[d]},_setElementInstance:function(h,f,g){var e=this._getElementCache(h,"nodeContextInstance"),d=this.name+"."+f;e[d]=g},_getElementCache:function(f,e){var d=f.data(e);if(!d){d={};f.data(e,d)}return d},_initNode:function(f){var d=this,e=this._queryNodes(f.name);e&&c(e).each(function(){d._initElement(this,f)})},_queryNodes:function(d){d=d.indexOf("~")===0?"body":/^#|\./.test(d)?d:"."+d;return c(d,this.root)},_resolveNode:function(m){m=c(m);var d=this._getElementCache(m,"nodeContextName"),h=this.name;var e=d[h];if(e){return this._nodes[e]}var g=(m[0].className||"").split(/\s+/);for(var l=0,n=g.length;l<n;l++){var f=this._nodes[g[l]];if(f){d[h]=f.name;return f}}for(var j in this._nodes){var f=this._nodes[j];if(f.name.indexOf("~")!==-1&&m.is(f.name)){d[h]=f.name;return f}}},_initElement:function(m,h){var m=c(m),g=h.config,p=h.options,d=p.entryName,o=g[d],i=m.data(p.configField),j=null,l=this._getElementCache(m,"nodeContextGuard"),n=this.name+"."+h.name,f=c.now();if(!o){c.error("entry function ["+d+"] for "+m[0]+" is no exist.")}if(p.once&&l[n]){return}try{if(o(m[0],i,this._refreshData)===false){return}j={element:m[0],config:i};j.context=p.context?this._getElementInstance(m,h.name):g;this.triggerHandler("afterinit",j);p.once&&(l[n]=true);c.log(n+" initialized, cost: "+(c.now()-f)+" ms")}catch(k){c.log(h.name+" init failed: ");c.error(k)}},getContext:function(e){var d=this._getElementNode(e);if(!d){return null}return d.options.context?this._getElementInstance(c(e),d.name):d.config},_getElementNode:function(d){return typeof d==="string"?this._nodes[d]:this._resolveNode(d)},isInited:function(f){f=c(f);var e=this._getElementCache(f,"nodeContextGuard"),d=this._resolveNode(f);return e[this.name+"."+d.name]||false},execute:function(i,g,f){var h=this._getElementNode(i);if(!h){c.log(this.name+".exeute("+g+"): node not exist, return undefined");return}var e=h.config,d=null;f=[].slice.call(arguments,2);if(h.options.context===true){if(typeof i==="string"){i=this._queryNodes(i)}d=this._getElementInstance(c(i),h.name);if(!d){c.error("instance not exist")}c.log(this.name+".execute: "+h.name+"#"+g);return d[g].apply(d,f)}else{c.log(this.name+".execute: "+h.name+"."+g);return e[g].apply(e,f)}}},c.EventTarget);b.NodeContext=a})(jQuery,Platform.winport);