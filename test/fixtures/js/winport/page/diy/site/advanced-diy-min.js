(function(c,a){var f=a.widget.PagingSwitcher,g=a.widget.Dialog,d=a.diy.ModBox,i=a.diy.Component,j=a.diy.Diy,b=a.diy.Msg;var h={init:function(){var k=this,l=c("div.setting-bar a.advanced-diy","#header");this.url=l.data("url");this.tpl=FE.util.sweet(this.template);l.click(function(m){m.preventDefault();k.open()})},open:function(){this.dialog=g.open({header:"高级装修",draggable:true,content:c.proxy(this,"loadContent"),className:"advanced-diy-dialog",contentSuccess:c.proxy(this,"contentSuccess")})},loadContent:function(m){var k=this,l=function(){m('<div class="d-error">网络繁忙，请稍候重试！</div>')};c.ajax(this.url,{dataType:"jsonp",success:function(n){if(!n.success){return l()}var p=k.filterData(n.data),o=k.tpl.applyData(p);m(o)},error:l})},filterData:function(m){var l=this,n=[],k=[];c.each(m,function(o,r){var q=Math.floor(o/6),p=k[q]=k[q]||[];p[o%6]=r;if(l.canAppEdit(r)){r.eidtIndex=r.editIndex||100000+o;n.push(r)}});n.sort(function(p,o){return p.editIndex-o.editIndex});return{lists:k,settingList:n}},canAppEdit:function(k){if(!k.editable||!k.purchased){return false}if(k.modId&&this.isDetailPage()){return false}return true},isDetailPage:function(){return c("div.mod.wp-offerdetail","#winport-content").length>0},contentSuccess:function(k){this.panel=c("div.advanced-diy-panel",k.node);this.initSettingPart();this.initPurchasePart()},initSettingPart:function(){var k=this,l=c("div.setting-part",this.panel);l.delegate("a.setting","click",function(n){var m=c(this),o=m.data("modId");if(!o){return}n.preventDefault();if(m.data("running")){return}m.data("running",true);e[o].edit(function(p){m.data("running",false);p&&k.dialog.close()})})},initPurchasePart:function(){var k=c("div.purchase-part",this.panel);this.initPagingNav(k);this.handlePurchased(k)},initPagingNav:function(m){var l=c("ul.paging-nav li",m),k=c("ul.items-list",m);new f(l,k)},handlePurchased:function(k){k.delegate("a.purchased","click",function(l){l.preventDefault()})},template:'<div class="advanced-diy-panel">	<% if (settingList.length) { %>	<div class="setting-part">		<h3>您可以设置</h3>		<ul class="items-list">		<% foreach (settingList as app) { %>			<li>				<div class="image" title="<%= app.name %>"><img src="<%= app.iconUrl %>" alt="<%= app.name %>" /></div>				<div class="wrap">					<h4><span><%= app.name %></span> <a href="<%= app.demoUrl %>" target="_blank">查看示例</a></h4>					<p class="desc"><%= app.desc %></p>					<div><a href="<% if (app.editUrl) { %><%= app.editUrl %><% } else { %>#<% } %>" <% if (app.modId) { %>data-mod-id="<%= app.modId %>"<% } %> class="setting wp-btn-01" target="_blank"><span>设置</span></a></div>				</div>			</li>		<% } %>		</ul>	</div>	<% } %>	<div class="purchase-part">		<h3>通过高级装修，可为旺铺加入公司视频、大图轮播橱窗等特色板块，并可以制作个性化的招牌和主题，让您可好地展示产品信息，提升企业形象。<a href="http://view.china.alibaba.com/cms/itbu/chengganli.html?tracelog=wp_advlink" target="_blank">查看完整示例&gt;&gt;</a></h3>		<% foreach (lists as list) { %>		<ul class="items-list" style="display: none;">			<% foreach (list as app) { %>			<li class="<% if (app.purchased) { %>is-purchased<% } %>">				<div class="image" title="<%= app.name %>"><img src="<%= app.iconUrl %>" alt="<%= app.name %>" /></div>				<div class="wrap">					<h4><span><%= app.name %></span> <a href="<%= app.demoUrl %>" target="_blank">查看示例</a></h4>					<p class="desc"><%= app.desc %></p>					<div class="op">						<% if (app.needRenew) { %>							<a href="<%= app.purchaseUrl %>" class="renew wp-btn-01" target="_blank"><span>续费</span></a>						<% } else if (app.purchased) { %>							<a href="#" class="purchased wp-btn-01-disabled"><span>已购买</span></a>							<% if (app.helpUrl) { %><a href="<%= app.helpUrl %>" class="help" target="_blank">查看帮助</a><% } %>						<% } else { %>							<a href="<%= app.purchaseUrl %>" class="purchase wp-btn-01" target="_blank"><span>购买</span></a>							<% if (app.tryUrl) { %><a href="<%= app.tryUrl  %>" class="try" target="_blank">马上试用</a><% } %>						<% } %>					</div>				</div>			</li>			<% } %>		</ul>		<% } %>		<div class="part-footer">			<ul class="paging-nav">				<% for (var i = 0; i < lists.length; i++) { %>				<li data-paging="<%= i %>"><a href="#"><%= i + 1 %></a></li>				<% } %>			</ul>		</div>	</div>	<div class="banner-area"><iframe frameborder="0" scrolling="no" src="http://view.china.alibaba.com/cms/itbu/mkword.html"></iframe></div></div>'};var e={};e["vas-marketingPoster"]={cid:"vas.winport:marketingPoster",edit:function(k){this.prepareRegion(c.proxy(this,"doEdit",k))},doEdit:function(n,m){var k=c("div.vas-marketingPoster",m),l=null;if(k.length){l=k.closest("div.mod-box");n(true);d.edit(l)}else{this.create(m,n)}},create:function(l,m){var k=c("div.mod",l).length;d.add({cid:this.cid,region:l,index:k,success:function(){m(true)},error:function(n){b.error(n);m(false)}})},prepareRegion:function(m){var k=c("#winport-fly"),l=c("div.region:first",k);if(l.length){m(l);return}k.prepend(c(this.template));this.saveLayout(function(){l=c("div.region:first",k);m(l)},function(){b.error("编辑板块失败，请刷新后重试！")})},saveLayout:function(o,l){var n=i.getContentConfig(),k=n.saveLayoutUrl,m={_csrf_token:i.getDocConfig()._csrf_token,version:n.version,pageSid:n.sid,pageContent:i.getPageLayout(),delList:"[]"};j.authAjax(k,{type:"POST",data:m,dataType:"json",success:function(p){if(p.success){++n.version;o()}else{l()}}})},template:'<div class="layout-box" data-box-config=\'{"sid":0,"cid":"layout:p32-m0"}\'>	<div class="layout p32-m0">		<div class="grid-main">			<div class="main-wrap region"  data-region-config=\'{"cid":"MAIN"}\' ></div>		</div>	</div></div>'};a.PageContext.register("~AdvancedDiy",h)})(jQuery,Platform.winport);