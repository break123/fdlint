(function(d){d.fn.inplaceEditor=function(l){l=l||{};var m=typeof l;if(m==="string"){var n=l,k=arguments[1];this.each(function(){var p=d(this),o=null;if(k&&n==="start"){k=typeof k==="function"?k(this):k;p.data("inplace-editor-options",k)}o=p.data("inplace-editor-options");o&&i[n](p,o)});return}if(m==="function"){this.each(function(){var p=d(this),o=l(this);p.data("inplace-editor-options",o);o.event&&g(p,o)})}else{if(m==="object"){this.data("inplace-editor-options",l);l.event&&this.each(function(){g(d(this),l)})}else{throw new Error("argument error.")}}};var i={start:function(o,l){if(this.isActive(o)){return}this._setActive(o,true);c(o);var m=o.data("inplace-editor");if(!m){m=e(o,l,"editor",new f(o,l));o.data("inplace-editor",m)}var n=j(o,l),k=m.open(n);l.onstart&&l.onstart.call(o.get(0));k===true?this.submit(o,l):k===false?this.cancel(o,l):null},submit:function(r,m){if(!this.isActive(r)){return}if(r.data("inplace-editor-submitting")){return}var k=this,n=r.data("inplace-editor"),l=r.data("inplace-editor-value"),p=n.value(),o=false,q=null;if(m.validate&&!m.validate.call(r.get(0),p,l)){return}r.data("inplace-editor-submitting",true);q=function(s){if(o){return}o=true;if(a(r,m,s)){k._setActive(r,false)}r.data("inplace-editor-submitting",false)};(m.submit||b).call(r.get(0),p,q,n,m);m.onsubmit&&m.onsubmit.call(r.get(0))},cancel:function(l,k){if(!this.isActive(l)){return}this._setActive(l,false);a(l,k,{status:"cancel"});k.oncancel&&k.oncancel.call(l.get(0))},isActive:function(k){return k.data("inplace-editor-active")},_setActive:function(l,k){l.data("inplace-editor-active",k)}};function g(m,k){var l=e(m,k,"event","click");m.bind(l,function(){i.start(m,k)})}function c(l){var k=l.find(".inplace-editor-text");if(k.length==0){k=l.find("div:first,span:first");k.length?k.addClass("inplace-editor-text"):l.wrapInner('<span class="inplace-editor-text" />')}}function h(k){return k.find(".inplace-editor-text")}function j(m,k){var l=m.data("inplace-editor-value");if(l===undefined){l=e(m,k,"value",h(m).text());m.data("inplace-editor-value",l)}return l}function e(o,m,l,n){var k=m[l];k=(typeof k==="function")?k.call(o.get(0)):k;return k===undefined?n:k}function a(q,k,o){o=o||{};var p=h(q),m=q.data("inplace-editor");if(o.status==="success"){q.data("inplace-editor-value",m.value());if(o.text){p.text(o.text)}else{if(o.html){p.html(o.html)}else{var l=(m.text||m.value).call(m);l?p.text(l):p.html("&nbsp;")}}k.success&&k.success.call(q.get(0),o)}else{if(o.status==="error"){var n=o.message||"submit error, please retry.";k.error&&k.error.call(q.get(0),n);return false}}m.close&&m.close();return true}var f=function(l,k){this.elm=l;this.options=k};d.extend(f.prototype,{open:function(l){var m=h(this.elm),k=this.editor;if(!k){k=this.editor=this._create(this.elm,this.options);this._handleAutosubmit();this.name=k.attr("name");k.css("display","none");m.after(k)}k.val(l);m.hide();k.show().focus().select()},close:function(){this.editor.hide();h(this.elm).show()},value:function(){return d.trim(this.editor.val())},text:function(){if(this.editor.is("select")){var l=this.editor.get(0),k=l.options[l.selectedIndex];return k&&k.text}else{return this.editor.val()}},_create:function(p,l){var o=e(p,l,"type"),n=null,m=p.width()-5;m=(m<20?20:m)+"px";if(o=="textarea"){n=d('<textarea class="inplace-editor-textarea" />').css("width",m)}else{if(o=="select"){n=d('<select class="inplace-editor-select" />');var k=e(p,l,"items",[]);this._appendItems(n,k)}else{n=d('<input type="text" class="inplace-editor-input" />').css("width",m)}}n.addClass("inplace-editor");n.attr("name",e(p,l,"name","inplace-editor"));n.attr(e(p,l,"attr",{}));n.css(e(p,l,"css",{}));return n},_appendItems:function(m,l){var k=this;d.each(l,function(n,o){if(typeof o==="object"){k._appendItems(m,o)}else{m.append(d('<option value="'+n+'">'+o+"</option>"))}})},_handleAutosubmit:function(){var l=this,n=this.elm,m=this.options,k=e(n,m,"autosubmit",!!m.event);k&&this.editor.blur(function(){var o=n.data("inplace_editor_value"),p=l.value();i[o==p?"cancel":"submit"](n,m)})}});function b(p,k,n,m){var q=d(this),l=e(q,m,"url");if(!l){throw new Error("please specify the url for ajax submit.")}var o=d.extend({},e(q,m,"data",{}));o.name=d(n).attr("name");o.value=p;d.ajax(l,{type:"POST",data:o,success:function(s){var r=d.parseJSON(s);(r&&r.status)?k(r):k({status:"error",message:"ajax response data format error."})},error:function(){k({status:"error",message:"connect to remote server error."})}})}d.add("wp-inplaceeditor")})(jQuery);