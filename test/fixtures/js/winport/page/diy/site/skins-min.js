(function(f,c){var h=c.Util,b=c.UI,g=c.widget.PagingSwitcher,a=c.Schedule,i=c.diy.Diy,d=c.diy.Msg;var e={init:function(k,j){this.div=k;this.config=j;this.initCatsPanel();this.initSkinsPanel()},initCatsPanel:function(){var j=f("div.skins-list-body",this.div),k=f("ul.skins-cats",this.div);new g("a[data-paging]",j,{delegate:k})},initSkinsPanel:function(){var k=this,j=f("div.skins-list",this.div),l=f("li",j),m=this.getSkinsGroup(l);j.delegate("li","click",function(){var o=f(this),n=o.data("skin");if(!n){return}l.removeClass("selected");f(m[n.cid]).addClass("selected");k.applySkin(n);return false})},getSkinsGroup:function(j){var k={};j.each(function(){var l=f(this).data("skin"),m=null;if(l){m=l.cid;k[m]=k[m]||[];k[m].push(this)}});return k},applySkin:function(n){var l=f("#skin-link"),k=l.attr("href"),j=this.config.applySkinUrl,m=null;if(k===n.url){return}l.attr("href",n.url);m=function(){i.authAjax(j,{type:"POST",dataType:"json",data:{cid:n.cid,_csrf_token:f("#doc").data("doc-config")._csrf_token},success:function(o){if(o.success){f(window).trigger("diychanged",{type:"apply-skin"});d.info("风格选择成功")}else{l.attr("href",k);d.error("风格选择失败，请刷新后重试。")}}})};h.schedule("apply-skin",m)}};c.SettingContext.register("diy-skins",e,{configField:"skinsConfig"})})(jQuery,Platform.winport);