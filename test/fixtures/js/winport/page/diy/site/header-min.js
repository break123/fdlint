(function(e,d){var i=d.Util,c=d.UI,a=d.widget.Tabs,b=d.widget.AjaxLink,f=d.widget.FloatPanel,g=d.widget.FloatTips;var h={init:function(j){this.docCfg=e("#doc").data("docConfig");this.bar=e("div.setting-bar",j);this.panel=e("div.setting-panel",j);this.tabs=e("ul.setting-tabs>li",this.bar);this.body=e("div.setting-panel-body",this.panel);c.positionFixed(this.bar);this.initTabs();this.initContext();this.initHelpPanel();this.initCollapseBar();this.initHeaderState();this.initPublishTooltip()},initTabs:function(){var j=this;new b(this.tabs,{cache:false,update:this.body,before:function(){j.tabsLinkBefore(e(this))},confirm:function(){var k=e(this).data("panelLoaded");k&&j.expandPanel(true);return !k},success:function(){j.tabsLinkSuccess(e(this))}})},tabsLinkBefore:function(k){var j=this;this.expandPanel(true);this.tabs.removeClass("selected");k.addClass("selected");clearTimeout(this.tabsTimer);this.tabsTimer=setTimeout(function(){j.body.html('<div class="setting-panel-loading">正在加载...</div>')},100)},tabsLinkSuccess:function(j){clearTimeout(this.tabsTimer);if(!j.hasClass("selected")){this.tabs.removeClass("selected");j.addClass("selected")}this.tabs.removeData("panelLoaded");j.data("panelLoaded",true);var k=e("div.setting-node",this.body);if(k.length){this.initSettingNodeTabs(k);d.SettingContext.refresh(k,this.pageData);this.pageData=null}},initSettingNodeTabs:function(l){var k=e("ul.setting-node-tabs>li",l),j=e("ul.setting-node-body>li",l);if(k.length&&j.length){new a(k,j)}},initContext:function(){d.SettingContext.loadPage=e.proxy(this,"loadSettingPage")},loadSettingPage:function(j,l){var k=this.tabs.eq(j);this.pageData=l;b.load(k)},initHelpPanel:function(){var j=e("div.help-panel",this.bar),l=e("a.help-link",j),k=null;k=new f(j,{handler:l,toggle:true,show:function(){j.addClass("selected")},hide:function(){j.removeClass("selected")}});j.delegate("ul.help-topics li","click",function(){k.hide()})},initCollapseBar:function(){var k=this,o=e("div.collapse-bar a.handle",this.panel),m=e("div.expand-bar",this.bar),l=e("a.handle",m),n=e(window),p=e("#header"),j=null;o.click(function(){k.expandPanel(false);return false});l.click(function(){k.expandPanel(true);return false});n.bind("scroll resize",function(){var r=n.scrollTop(),s=p.hasClass("collapsed"),q=p.hasClass("expanded");j=j||e(k.panel).height()-m.height();if(!s&&!q){return}p[r>j?"addClass":"removeClass"]("panel-scrollout")})},expandPanel:function(j){var k=e("#header");k.toggleClass("expanded",j);k.toggleClass("collapsed",!j);window.scroll(0,0)},initHeaderState:function(){this.docCfg.showTutorialWizard&&this.tabs.eq(0).click()},initPublishTooltip:function(){var k=this,j=false,l=e("#header div.setting-tools"),m="点此发布可应用您的修改到旺铺";e(window).bind("diychanged",function(){if(j){return}new g(l,m,{className:"publish-tips"});j=true})}};d.PageContext.register("#header",h);d.SettingContext=new d.NodeContext("SettingContext",{root:"#header"})})(jQuery,Platform.winport);