(function(f,d){var i=d.Util,c=d.UI,j=d.Component,e=d.mod.unit.WPAlitalk,g=d.widget.FloatPanel,b=d.widget.DataStore;var h={init:function(l,k){this.div=l;this.config=k;this.docConfig=j.getDocConfig()||{};this._initContact();this.name="SupplierInfo";i.initParts(this,[l,k])},_initContact:function(){var k=f("a[data-alitalk]",this.div);e.init(k)}};var a=(h.Parts={});a.TPSummary={init:function(p,m){var k=this,l=m.tpCombineInfoUrl,n=this.docConfig.uid;if(!l){return}f.ajax(l,{dataType:"jsonp",data:{member_ids:this.docConfig.uid,combine:"logo;period;type;score","logo.type":"WINPORT_V2"},success:function(q){k.render(q[n]||{})}})},render:function(k){this.renderTpLogo(k);this.renderTpScore(k.score.score)},renderTpLogo:function(n){var m=f("div.tpinfo",this.div),l=f("a.tplogo",m),k=f("a.tpyear",m);k.addClass("time-point-"+n.period.year).show();if(n.tpType.product.isLimitEdition==="true"){m.addClass("tpinfo-limit")}n.logo.url&&l.append(f("<img>",{src:n.logo.url}));m.css("visibility","visible")},renderTpScore:function(l){var k=f("dl.tp-score a.score-value",this.div);l?k.text(l):k.replaceWith("--")}};a.Guarantee={init:function(p,n){var l=this,k=f("div.guarantee",p),m=n.guardUrl;if(!m||!k.length){return}b.request("supplier-info-guarantee",m,{dataType:"jsonp",data:{summarys:"guarantee",memberId:this.docConfig.uid},success:function(r){var q=r.data||{};r.success&&q.guarantee&&l.render(k,q.guarantee)}})},render:function(l,k){var m=f("a.group-trust",l),p=f("p.guarantee-money span.value",l),n=k.position;if(n==="NON_GUARANTEE"){return}if(n!=="GUARANTEE"){m.show()}p.text(parseInt(k.totalBalanceMoney,10)||0);l.show()}};a.ProcessPanel={init:function(){var k=this,l=f("div.feature",this.div),n=f("dd.process-panel-wrap",l),m=f("a.process-ability",l);if(!n.length){return}m.one("mouseenter",function(){var p=k.config.manufactureUrl;f.ajax(p,{dataType:"script",success:function(){var q=window.WP_MANUFACTURE_INFO;if(!q){return}o=f.parseJSON(q);if(o.success&&!o.isEmpty){k.render(n,m,o);m.mouseenter()}}})})},render:function(n,m,p){c.htmlTemplate(n);var l=f("div.process-panel",n),k=function(r,q){q?r.text(q.replace(/\.\.$/,"µÈ")):r.hide().prev("dt").hide()};k(f("dd.style-value",l),p.mfType);k(f("dd.craft-value",l),p.mfTechnologyType);k(f("dd.domain-value",l),p.mfServiceArea);new g(l,{handler:m,event:"mouseenter",autoClose:300})}};a.PrivatePanel={init:function(){var k=this,n=f("dl.member-service",this.div),m=f("dd.private-panel-wrap",n),l=f("a.private,a.discount",n);if(!m.length){return}l.eq(0).closest("dd").one("mouseenter",function(){var p=k.config.partnerRelationAjaxUrl;f.ajax(p,{dataType:"jsonp",data:{supplierId:k.docConfig.uid},success:function(q){k.render(m,l,q);l.mouseenter()}})})},render:function(m,w,n){c.htmlTemplate(m);var k=f("div.private-panel",m),p=f("div.not-auth-member",k),l=f("div.is-auth-member",k),u=f(".discount-part",k);if(n.discount){f("span.discount-value em",u).text(n.discount)}else{u.hide()}if(n.isMember){p.hide();!n.priceAuth&&f("p.price-part",l).hide();!n.picAuth&&f("p.pic-part",l).hide();f("span.partner-level",l).text(n.partnerLevel)}else{l.hide();var q=f("dl.offer-part",p),r=parseInt(f("span.offer-count em",q).text(),10);!r&&q.hide();var s=this.docConfig.isLogin,v=f("a.apply-btn",p),t=f("a.login-btn",p);if(s){v.click(function(){f("#winport-apply-partner-form").submit();return false});t.hide()}else{t.attr("href",this.config.ssoLoginLink+document.location.href);v.hide()}}new g(k,{handler:w,event:"mouseenter",autoClose:300})}};a.Precharge={init:function(){var l=this,k=f("dl.spec-service",this.div),n=f("dd.precharge-panel-wrap",k),m=f("a.precharge",k);if(!n.length){return}m.one("mouseenter",function(){var p=l.config.prechargeUrl;f.ajax(p,{dataType:"script",success:function(){var q=window.WP_PRECHARGE_INFO,r=null;if(q&&(r=q.prechargeSummInfo)){l.render(n,m,r);m.mouseenter()}}})})},render:function(m,l,n){c.htmlTemplate(m);var k=f("div.precharge-panel",m);this.renderPanel(k,n);new g(k,{handler:l,event:"mouseenter",autoClose:300})},renderPanel:function(k,m){var l=f("a.apply",k);f("span.first-inpour-limit em",k).text(m.firstInpourLimit);f("span.refund-rate em",k).text(m.refundRate);if(m.isOwner){l.css("display","block");return}if(m.isPrecharger){f("span.available-fund",k).text(m.availableFund);f("dd.available-fund-part",k).show();f("a.charge",k).css("display","block")}else{l.css("display","block")}}};a.SatRate={init:function(){var l=this,k=f("dl.sat-rate",this.div),m=this.config.satisfactionRateUrl;if(!k.length||!m){return}f.ajax(m,{data:{memberId:this.docConfig.uid},dataType:"jsonp",success:function(n){n.success&&l.success(k,n.data)}})},success:function(l,q){var n=f("a.rate-value",l),m=parseFloat(q.satisfactionRate),p=q.remarkCount,k=f("div.sat-rate-panel",l);if(m<=0){return}m&&n.text(m+"%");p&&f("span.remark-count",k).text(p);l.show();new g(k,{handler:n,event:"mouseenter",autoClose:300})}};a.HonorFeature={init:function(){var k=this,l=this.config.honorFeatureRequestUrl,m=this.docConfig.uid;if(!l){return}f.ajax(l,{dataType:"jsonp",data:{appName:"winport",vAccountIds:m,code:"WP_CODE"},success:function(n){n.success&&n.data&&k.render(n.data[m])}})},render:function(p){var k=f("dl.honorfeature",this.div),m=f("ul",k),n='<li><a href="{targetUrl}" target="_blank"><img src="{imageUrl}" alt="" /></a></li>',s=this.docConfig.imageServer,r="http://view.china.alibaba.com",l=false,q=null;q=f.map(p,function(v,u){var t=s+"/"+v.imageUrl,w=r+"/"+v.targetUrl;l=true;return f.util.substitute(n,{targetUrl:w,imageUrl:t})});m.append(q.join(""));l&&k.show()}};d.ModContext.register("wp-supplier-info",h)})(jQuery,Platform.winport);